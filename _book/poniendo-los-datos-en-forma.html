<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Poniendo los datos en forma | Ciencia de Datos para Activismo Jurídico</title>
  <meta name="description" content="3 Poniendo los datos en forma | Ciencia de Datos para Activismo Jurídico" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Poniendo los datos en forma | Ciencia de Datos para Activismo Jurídico" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="bitsandbricks/CD_AJ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Poniendo los datos en forma | Ciencia de Datos para Activismo Jurídico" />
  
  
  

<meta name="author" content="Antonio Vazquez Brust" />
<meta name="author" content="Demian Zayat" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="una-presentación-a-toda-marcha-de-r.html"/>
<link rel="next" href="visualización.html"/>
<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Ciencia de Datos para Activismo Jurídico</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a>
<ul>
<li><a href="index.html#para-quién-es-esto">¿Para quién es esto?<span></span></a></li>
<li><a href="index.html#antes-de-empezar">Antes de empezar<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="qué-es-la-ciencia-de-datos.html"><a href="qué-es-la-ciencia-de-datos.html"><i class="fa fa-check"></i><b>1</b> ¿Qué es la ciencia de datos?<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="qué-es-la-ciencia-de-datos.html"><a href="qué-es-la-ciencia-de-datos.html#qué-significa-hacer-ciencia-de-datos"><i class="fa fa-check"></i><b>1.1</b> ¿Qué significa hacer ciencia de datos?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html"><i class="fa fa-check"></i><b>2</b> Una presentación a toda marcha de R<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#nuestro-primer-proyecto-en-r"><i class="fa fa-check"></i><b>2.1</b> Nuestro primer proyecto en R<span></span></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#a-investigar-cual-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><i class="fa fa-check"></i><b>2.1.1</b> A investigar: ¿Cual es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?<span></span></a></li>
<li class="chapter" data-level="2.1.2" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#crear-un-proyecto-en-rstudio"><i class="fa fa-check"></i><b>2.1.2</b> Crear un proyecto en RStudio<span></span></a></li>
<li class="chapter" data-level="2.1.3" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#escribiendo-un-script"><i class="fa fa-check"></i><b>2.1.3</b> Escribiendo un script<span></span></a></li>
<li class="chapter" data-level="2.1.4" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#cargar-los-datos"><i class="fa fa-check"></i><b>2.1.4</b> Cargar los datos<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#visualización-la-exploración-gráfica-de-la-información"><i class="fa fa-check"></i><b>2.2</b> Visualización: la exploración gráfica de la información<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#haciendo-mapas"><i class="fa fa-check"></i><b>2.2.1</b> Haciendo mapas<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#agregando-datos"><i class="fa fa-check"></i><b>2.2.2</b> Agregando datos<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#el-veredicto-final"><i class="fa fa-check"></i><b>2.3</b> El veredicto final<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#cuál-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><i class="fa fa-check"></i><b>2.3.1</b> ¿Cuál es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="una-presentación-a-toda-marcha-de-r.html"><a href="una-presentación-a-toda-marcha-de-r.html#ejercicios"><i class="fa fa-check"></i><b>2.4</b> Ejercicios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html"><i class="fa fa-check"></i><b>3</b> Poniendo los datos en forma<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo"><i class="fa fa-check"></i><b>3.1</b> Primeros pasos al examinar un conjunto de datos nuevo<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#cruzando-variables-la-operación-join"><i class="fa fa-check"></i><b>3.2</b> Cruzando variables: la operación <code>join</code><span></span></a></li>
<li class="chapter" data-level="3.3" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#transformando-los-datos"><i class="fa fa-check"></i><b>3.3</b> Transformando los datos<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#seleccionar-columnas-con-select"><i class="fa fa-check"></i><b>3.3.1</b> Seleccionar columnas con <code>select()</code><span></span></a></li>
<li class="chapter" data-level="3.3.2" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#filtrar-filas-con-filter"><i class="fa fa-check"></i><b>3.3.2</b> Filtrar filas con <code>filter()</code><span></span></a></li>
<li class="chapter" data-level="3.3.3" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#ordenar-filas-con-arrange"><i class="fa fa-check"></i><b>3.3.3</b> Ordenar filas con <code>arrange()</code><span></span></a></li>
<li class="chapter" data-level="3.3.4" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#agregar-nuevas-variables-con-mutate"><i class="fa fa-check"></i><b>3.3.4</b> Agregar nuevas variables con <code>mutate()</code><span></span></a></li>
<li class="chapter" data-level="3.3.5" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#extraer-resúmenes-con-summarise"><i class="fa fa-check"></i><b>3.3.5</b> Extraer resúmenes con <code>summarise()</code><span></span></a></li>
<li class="chapter" data-level="3.3.6" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#bonus-el-operador-pipe"><i class="fa fa-check"></i><b>3.3.6</b> ¡BONUS! El operador “pipe”: <code>%&gt;%</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="poniendo-los-datos-en-forma.html"><a href="poniendo-los-datos-en-forma.html#ejercicios-1"><i class="fa fa-check"></i><b>3.4</b> Ejercicios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualización.html"><a href="visualización.html"><i class="fa fa-check"></i><b>4</b> Visualización<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualización.html"><a href="visualización.html#una-buena-visualización-para-empezar-el-scatterplot"><i class="fa fa-check"></i><b>4.1</b> Una buena visualización para empezar: el <em>scatterplot</em><span></span></a></li>
<li class="chapter" data-level="4.2" data-path="visualización.html"><a href="visualización.html#ajustando-color-y-tamaño"><i class="fa fa-check"></i><b>4.2</b> Ajustando color y tamaño<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="visualización.html"><a href="visualización.html#facetado"><i class="fa fa-check"></i><b>4.3</b> Facetado<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="visualización.html"><a href="visualización.html#gráficos-de-barras"><i class="fa fa-check"></i><b>4.4</b> Gráficos de barras<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="visualización.html"><a href="visualización.html#histogramas"><i class="fa fa-check"></i><b>4.5</b> Histogramas<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="visualización.html"><a href="visualización.html#preparando-una-visualización-para-compartir"><i class="fa fa-check"></i><b>4.6</b> Preparando una visualización para compartir<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="visualización.html"><a href="visualización.html#otras-visualizaciones"><i class="fa fa-check"></i><b>4.7</b> Otras visualizaciones<span></span></a></li>
<li class="chapter" data-level="4.8" data-path="visualización.html"><a href="visualización.html#ejercicios-2"><i class="fa fa-check"></i><b>4.8</b> Ejercicios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html"><i class="fa fa-check"></i><b>5</b> Analisis de texto<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#manipulación-de-texto"><i class="fa fa-check"></i><b>5.1</b> Manipulación de texto<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#metacaracteres"><i class="fa fa-check"></i><b>5.2</b> Metacaracteres<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#comienzo-y-fin-de-línea"><i class="fa fa-check"></i><b>5.2.1</b> Comienzo y fin de línea<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#clases-de-palabras"><i class="fa fa-check"></i><b>5.2.2</b> Clases de Palabras<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#lookaround"><i class="fa fa-check"></i><b>5.2.3</b> Lookaround<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#primer-ejercicio"><i class="fa fa-check"></i><b>5.3</b> Primer ejercicio<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#consiguiendo-los-datos"><i class="fa fa-check"></i><b>5.3.1</b> Consiguiendo los datos<span></span></a></li>
<li class="chapter" data-level="5.3.2" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#limpieza-de-datos"><i class="fa fa-check"></i><b>5.3.2</b> Limpieza de datos<span></span></a></li>
<li class="chapter" data-level="5.3.3" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#análisis"><i class="fa fa-check"></i><b>5.3.3</b> Análisis<span></span></a></li>
<li class="chapter" data-level="5.3.4" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#quienes-hablaron"><i class="fa fa-check"></i><b>5.3.4</b> Quienes hablaron?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="analisis-de-texto.html"><a href="analisis-de-texto.html#ejercicios-3"><i class="fa fa-check"></i><b>5.4</b> Ejercicios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html"><i class="fa fa-check"></i><b>6</b> Trabajando con datos espaciales y temporales<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#trabajando-con-fechas"><i class="fa fa-check"></i><b>6.1</b> Trabajando con fechas<span></span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#la-fecha-como-clase-de-variable"><i class="fa fa-check"></i><b>6.1.1</b> La fecha como clase de variable<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#mirando-al-espacio"><i class="fa fa-check"></i><b>6.2</b> Mirando al espacio<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#obteniendo-un-mapa-base"><i class="fa fa-check"></i><b>6.2.1</b> Obteniendo un mapa base<span></span></a></li>
<li class="chapter" data-level="6.2.2" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#de-coordenadas-al-mapa"><i class="fa fa-check"></i><b>6.2.2</b> De coordenadas al mapa<span></span></a></li>
<li class="chapter" data-level="6.2.3" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#mapas-de-densidad"><i class="fa fa-check"></i><b>6.2.3</b> Mapas de densidad<span></span></a></li>
<li class="chapter" data-level="6.2.4" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#visualizando-multiples-categorías"><i class="fa fa-check"></i><b>6.2.4</b> Visualizando multiples categorías<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#combinando-espacio-y-tiempo"><i class="fa fa-check"></i><b>6.3</b> Combinando espacio y tiempo<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="trabajando-con-datos-espaciales-y-temporales.html"><a href="trabajando-con-datos-espaciales-y-temporales.html#ejercicios-4"><i class="fa fa-check"></i><b>6.4</b> Ejercicios<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ciencia de Datos para Activismo Jurídico</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poniendo-los-datos-en-forma" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Poniendo los datos en forma<a href="poniendo-los-datos-en-forma.html#poniendo-los-datos-en-forma" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="imagenes/amasando.jpg" width="100%" /></p>
<p>Cómo ya hemos mencionado, es normal que la mayor parte del tiempo dedicado a un proyecto de análisis se nos vaya en la limpieza y orden de los datos disponibles. Aún cuando nuestros datos provengan de fuentes oficiales (un gobierno nacional, el Banco Mundial, etc) en muy rara ocasión podremos usarlos para nuestros fines sin antes procesarlos. Y aún si los datos llegaran en perfectas condiciones, no tenemos forma de saberlo hasta haber realizado una exploración para verificarlo.</p>
<p>Ésta inevitable etapa de preparación es llamada <em>data wrangling</em> en inglés, algo así como el proceso de “domar los datos”. El término hace referencia, en clave de humor, al esfuerzo que requiere la puesta en orden cuando los datos son cuantiosos, de muchas fuentes distintas, o en particular desprolijos. Para que la experiencia sea lo menos tediosa posible, y podamos pasar rápido al momento de extraer conocimiento, vamos a practicar algunas técnicas muy útiles de <em>wrangling</em>.</p>
<div id="primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Primeros pasos al examinar un conjunto de datos nuevo<a href="poniendo-los-datos-en-forma.html#primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Si no lo hicimos aún en la sesión en la que estamos trabajando, cargamos <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="poniendo-los-datos-en-forma.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Vamos a practicar usando el dataset de delitos que publica el Ministerio de Justicia y Seguridad de la Ciudad Autónoma de Buenos Aires. Registra los homicidios, hurtos (sin violencia), lesiones y robos (con violencia) ocurridos en la ciudad durante el año 2020. Vamos a trabajar con una versión de los datos que ha sido simplificada para hacer más ameno el trabajo con ella. Quién quiera acceder a los datos en su esplendor de complejidad original, puede encontrarlos en el portal de datos abiertos de la ciudad: <a href="https://data.buenosaires.gob.ar/" class="uri">https://data.buenosaires.gob.ar/</a>.</p>
<p>Comenzamos por acceder al archivo con los registros para cargarlo en R como un dataframe. Esto requiere de una conexión a internet, pero no debería tomar mucho tiempo en ser descargado.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="poniendo-los-datos-en-forma.html#cb45-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://cdaj.netlify.app/data/delitos_barrios.csv&quot;</span>)</span></code></pre></div>
<p>Lo primero que deberíamos hacer con un dataframe que no conocemos es usar la función <code>str()</code>, que nos indica su estructura (por <em>structure</em> en inglés):</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="poniendo-los-datos-en-forma.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(delitos)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3188 obs. of  5 variables:
##  $ periodo: chr  &quot;01/2020&quot; &quot;01/2020&quot; &quot;01/2020&quot; &quot;01/2020&quot; ...
##  $ tipo   : chr  &quot;Homicidio&quot; &quot;Homicidio&quot; &quot;Homicidio&quot; &quot;Homicidio&quot; ...
##  $ subtipo: chr  &quot;Doloso&quot; &quot;Doloso&quot; &quot;Doloso&quot; &quot;Doloso&quot; ...
##  $ barrio : chr  &quot;Barracas&quot; &quot;Nueva Pompeya&quot; &quot;Retiro&quot; &quot;Saavedra&quot; ...
##  $ total  : int  1 1 1 1 1 1 1 2 1 1 ...</code></pre>
<p>Para empezar, nos enteramos que el objeto que estamos analizando es un dataframe (“data.frame”). Eso ya lo sabíamos, pero como <code>str()</code> puede usarse con cualquier clase de objeto en R, en ocasiones resultará que estamos ante un vector, una lista u otra clase de criatura. A continuación aparecen las dimensiones del dataframe: 3188 observaciones (filas) con 5 variables (columnas). Los nombres de las columnas son <em>periodo</em>, <em>tipo</em>, <em>subtipo</em>, <em>barrio</em> y <em>total</em>. Con eso ya podemos inferir que cada observación en el dataframe contiene la cantidad total de delitos según tipo y subtipo (aunque no sepamos bien de que se tratan esas variables), en un período dado y en cada barrio.</p>
<p>Con <code>str()</code> también obtenemos el tipo de datos representados por cada variable, y un ejemplo de los valores contenidos en las primeras filas. La variable <em>total</em> es de tipo “int”, es decir, números enteros o <em>integers</em> en inglés. El resto de las variables son de tipo “chr”; en R las variables de texto reciben el nombre de <em>characters</em>, caracteres.</p>
<p>La siguiente función a utilizar cuando estamos conociendo el contenido de un set de datos es <code>summary()</code>, que nos dará un resumen en forma de estadísticas descriptivas para las variables numéricas (cuartiles y mediana) .</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="poniendo-los-datos-en-forma.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(delitos)</span></code></pre></div>
<pre><code>##    periodo              tipo             subtipo             barrio         
##  Length:3188        Length:3188        Length:3188        Length:3188       
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##      total       
##  Min.   :  1.00  
##  1st Qu.:  3.00  
##  Median :  8.00  
##  Mean   : 20.93  
##  3rd Qu.: 22.00  
##  Max.   :393.00</code></pre>
<p>Para las variables de texto <code>summary()</code> no tiene mucho que decir. Aquí sería bueno que nos mostrara algún dato, quizás los valores más frecuentes, ¿verdad?. Eso va a ocurrir pero sólo cuando esas columnas con texto contengan variables categóricas, que en R reciben el tipo “factor” en lugar de “chr”.</p>
<div class="tip">
<p>Una variable es categórica cuando es razonable considerar que se elige entre un conjunto finito de variables posibles; por ejemplo, los barrios de Buenos Aires son un conjunto finito y predeterminado.</p>
</div>
<p>¿Pero cómo puede saber R si <em>tipo</em> o <em>barrio</em> son categorías? Pues podemos avisarle al cargar los datos con la función <code>read.csv()</code> que usamos al principio. Para que <code>read.csv()</code> interprete como variables categóricas a todas las columnas que contienen texto se usa el parámetro <code>stringsAsFactors</code>, así: <code>misdatos &lt;- read.csv("archivo_con_mis_datos", stringsAsFactors = TRUE)</code>. En general es buena idea evitar que los campos de texto se asuman como factores, pero en éste caso está bien: aquí todas las columnas de texto, en efecto, contienen variables categóricas.</p>
<p>Veamos que pasa si lo intentamos. Volvemos a leer el mismo dataset, esta vez con <code>stringsAsFactors = TRUE</code></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="poniendo-los-datos-en-forma.html#cb50-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://cdaj.netlify.app/data/delitos_barrios.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>.. y pedimos su resumen:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="poniendo-los-datos-en-forma.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(delitos)</span></code></pre></div>
<pre><code>##     periodo                        tipo                 subtipo    
##  01/2020: 284   Homicidio            : 163                  :1166  
##  02/2020: 281   Hurto (sin violencia):1087   Siniestro Vial : 644  
##  03/2020: 280   Lesiones             : 575   Con uso de moto: 517  
##  12/2020: 280   Robo (con violencia) :1363   Hurto Automotor: 504  
##  08/2020: 276                                Robo Automotor : 263  
##  11/2020: 274                                Doloso         :  81  
##  (Other):1513                                (Other)        :  13  
##            barrio         total       
##  Balvanera    :  81   Min.   :  1.00  
##  Barracas     :  81   1st Qu.:  3.00  
##  Flores       :  80   Median :  8.00  
##  Villa Lugano :  80   Mean   : 20.93  
##  Mataderos    :  76   3rd Qu.: 22.00  
##  Villa Soldati:  75   Max.   :393.00  
##  (Other)      :2715</code></pre>
<p>¡Esta vez obtuvimos un ranking con las categorías más frecuentes!</p>
<p>Las categorías posibles para un factor son llamadas “niveles” (<em>levels</em>). Para ver todos los niveles del factor <em>barrio</em>, es decir todos los barrios representados en la columna con ese nombre de variable, podemos usar la función <code>levels()</code></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="poniendo-los-datos-en-forma.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(delitos<span class="sc">$</span>barrio)</span></code></pre></div>
<pre><code>##  [1] &quot;&quot;                  &quot;Agronomía&quot;         &quot;Almagro&quot;          
##  [4] &quot;Balvanera&quot;         &quot;Barracas&quot;          &quot;Belgrano&quot;         
##  [7] &quot;Boca&quot;              &quot;Boedo&quot;             &quot;Caballito&quot;        
## [10] &quot;Chacarita&quot;         &quot;Coghlan&quot;           &quot;Colegiales&quot;       
## [13] &quot;Constitución&quot;      &quot;Flores&quot;            &quot;Floresta&quot;         
## [16] &quot;La Boca&quot;           &quot;Liniers&quot;           &quot;Mataderos&quot;        
## [19] &quot;Monserrat&quot;         &quot;Monte Castro&quot;      &quot;Nueva Pompeya&quot;    
## [22] &quot;Nuñez&quot;             &quot;Palermo&quot;           &quot;Parque Avellaneda&quot;
## [25] &quot;Parque Chacabuco&quot;  &quot;Parque Chas&quot;       &quot;Parque Patricios&quot; 
## [28] &quot;Paternal&quot;          &quot;Puerto Madero&quot;     &quot;Recoleta&quot;         
## [31] &quot;Retiro&quot;            &quot;Saavedra&quot;          &quot;San Cristóbal&quot;    
## [34] &quot;San Nicolás&quot;       &quot;San Telmo&quot;         &quot;Vélez Sársfield&quot;  
## [37] &quot;Versalles&quot;         &quot;Villa Crespo&quot;      &quot;Villa Del Parque&quot; 
## [40] &quot;Villa Devoto&quot;      &quot;Villa Gral. Mitre&quot; &quot;Villa Lugano&quot;     
## [43] &quot;Villa Luro&quot;        &quot;Villa Ortuzar&quot;     &quot;Villa Pueyrredón&quot; 
## [46] &quot;Villa Real&quot;        &quot;Villa Riachuelo&quot;   &quot;Villa Santa Rita&quot; 
## [49] &quot;Villa Soldati&quot;     &quot;Villa Urquiza&quot;</code></pre>
<p>Para acceder en forma rápida al contenido de la columna <em>barrio</em>, hemos utilizado por primera vez un truco muy práctico. Para obtener el contenido de cualquier columna en particular, basta con el nombre del dataframe seguido del símbolo <code>$</code> y el nombre de la columna a extraer: <code>delitos$tipo</code>, o <code>delitos$total</code>, etc.</p>
</div>
<div id="cruzando-variables-la-operación-join" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Cruzando variables: la operación <code>join</code><a href="poniendo-los-datos-en-forma.html#cruzando-variables-la-operación-join" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Al realizar un análisis “en la vida real”, es decir, usando datos salvajes en lugar de los prolijos datasets de práctica, es muy habitual encontrar que nos falta una variable que necesitamos. Si tenemos suerte, la información que necesitamos también está disponible en forma de tabla, con algún campo en común, y podemos llevar el cabo un cruce de datos para traérnosla.</p>
<p>Para expresarlo con un ejemplo concreto: hemos visto que los registros de delitos incluyen una columna con el barrio, que es la única variable relacionada con la geografía. Si nuestra unidad de análisis fuera la comuna<a href="trabajando-con-datos-espaciales-y-temporales.html#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> en lugar del barrio, necesitaríamos agregar la columna correspondiente. En este caso, estamos de suerte porque una tabla con los barrios de la Ciudad de Buenos Aires y la comuna a la que pertenecen es fácil de conseguir. Con esa tabla en nuestro poder, ya tenemos las piezas necesarias para el cruce de datos. En cada registro en el dataframe de delitos tenemos un barrio; podemos buscarlo en la tabla de barrios y comunas, tomar nota de la comuna asociada, y copiarla en nuestro dataset original. Por supuesto, hacerlo a mano para cada uno de las miles de filas en nuestro dataframe tardaría una eternidad, amén de que quizás podríamos hartarnos de la tarea antes de terminar. ¡Nada de eso! Vamos a resolverlo en meros instantes escribiendo unas pocas líneas de código. Antes de continuar hagamos una pausa para conmiserar a los investigadores de eras pasadas, antes de la popularización de la computadora personal, que realizaban tareas de esta escala con lápiz, papel y paciencia.</p>
<p>Existe una gran variedad de funciones que permiten combinar tablas relacionadas entre sí por una o varias variables en común. Para nuestro propósito, alcanza con conocer una: <code>left_join()</code>. La función toma como parámetros dos dataframes (que son tablas al fin y al cabo) busca las variables que tengan el mismo nombre y usándolas como referencia completa la primera de ellas, la de la izquierda, con los datos nuevos que aporta la segunda. <code>left_join</code> devuelve un dataframe nuevo con los datos combinados.</p>
<p>Manos a la obra. Descargamos el dataframe con barrios y comunas:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="poniendo-los-datos-en-forma.html#cb55-1" aria-hidden="true" tabindex="-1"></a>barrios_comunas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://cdaj.netlify.app/data/barrios_comunas.csv&quot;</span>)</span></code></pre></div>
<div class="warning">
<p>Si recibimos un mensaje de error al estilo de <strong><code>[...] Error in left_join(delitos, barrios_comunas) :    could not find function "left_join"</code></strong> es muy probable que nos hayamos olvidado de activar las funciones de Tidyverse. En ese caso, sólo necesitamos ejecutar <code>library(tidyverse)</code> e intentar de nuevo.</p>
</div>
<p>Echamos un vistazo, comprobando que existe “barrios”, una columna en común que lo relaciona con el dataframe de delitos,</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="poniendo-los-datos-en-forma.html#cb56-1" aria-hidden="true" tabindex="-1"></a>barrios_comunas</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["barrio"],"name":[1],"type":["chr"],"align":["left"]},{"label":["comuna"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Agronomía","2":"15"},{"1":"Almagro","2":"5"},{"1":"Balvanera","2":"3"},{"1":"Barracas","2":"4"},{"1":"Belgrano","2":"13"},{"1":"Boca","2":"4"},{"1":"Boedo","2":"5"},{"1":"Caballito","2":"6"},{"1":"Chacarita","2":"15"},{"1":"Coghlan","2":"12"},{"1":"Colegiales","2":"13"},{"1":"Constitución","2":"1"},{"1":"Flores","2":"7"},{"1":"Floresta","2":"10"},{"1":"La Boca","2":"4"},{"1":"Liniers","2":"9"},{"1":"Mataderos","2":"9"},{"1":"Monserrat","2":"1"},{"1":"Monte Castro","2":"10"},{"1":"Nueva Pompeya","2":"4"},{"1":"Nuñez","2":"13"},{"1":"Palermo","2":"14"},{"1":"Parque Avellaneda","2":"9"},{"1":"Parque Chacabuco","2":"7"},{"1":"Parque Chas","2":"15"},{"1":"Parque Patricios","2":"4"},{"1":"Paternal","2":"15"},{"1":"Puerto Madero","2":"1"},{"1":"Recoleta","2":"2"},{"1":"Retiro","2":"1"},{"1":"Saavedra","2":"12"},{"1":"San Cristóbal","2":"3"},{"1":"San Nicolás","2":"1"},{"1":"San Telmo","2":"1"},{"1":"Vélez Sársfield","2":"10"},{"1":"Versalles","2":"10"},{"1":"Villa Crespo","2":"15"},{"1":"Villa Del Parque","2":"11"},{"1":"Villa Devoto","2":"11"},{"1":"Villa Gral. Mitre","2":"11"},{"1":"Villa Lugano","2":"8"},{"1":"Villa Luro","2":"10"},{"1":"Villa Ortuzar","2":"15"},{"1":"Villa Pueyrredón","2":"12"},{"1":"Villa Real","2":"10"},{"1":"Villa Riachuelo","2":"8"},{"1":"Villa Santa Rita","2":"11"},{"1":"Villa Soldati","2":"8"},{"1":"Villa Urquiza","2":"12"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>y lo unimos (de allí el término “join”, unir en inglés) a nuestra data:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="poniendo-los-datos-en-forma.html#cb57-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="ot">&lt;-</span> <span class="fu">left_join</span>(delitos, barrios_comunas)</span></code></pre></div>
<p>Admiremos nuestra obra:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="poniendo-los-datos-en-forma.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(delitos)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Barracas","5":"1","6":"4","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Nueva Pompeya","5":"1","6":"4","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Saavedra","5":"1","6":"12","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"Femicidio","4":"Villa Devoto","5":"1","6":"11","_rn_":"5"},{"1":"01/2020","2":"Homicidio","3":"Siniestro Vial","4":"Balvanera","5":"1","6":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Es así de fácil. Bueno, no tanto… este fue un caso sencillo, pero hay todo tipo de datos y cruces allí afuera, y a veces se necesitan operaciones más complejas. Por eso hay toda una familia de funciones de <em>join</em> - <code>right_join()</code>, <code>inner_join()</code>, <code>full_join</code>, <code>anti_join()</code>, y alguna más. Pero podemos dejarlas en paz; para nuestras necesidades, con <code>left_join()</code> podemos arreglarnos muy bien.</p>
<p>Satisfechos con la mejora, si queremos guardar el dataframe “mejorado” para usarlo en otra ocasión, podemos hacerlo con <code>write.csv()</code>, que lo convierte en un archivo de texto que queda en nuestra PC.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="poniendo-los-datos-en-forma.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(delitos, <span class="st">&quot;delitos.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Podemos seguir siempre ese formato para guardar nuestros datos. El primer parámetro es el dataframe que vamos a guardar, el segundo -siempre entre comillas- es el nombre de archivo, y la opción final, <code>row.names = FALSE</code> sirve para evitar que R le agregue una columna al principio con números consecutivos (1, 2, 3, y así), cosa que quizás fue útil alguna vez pero en general no necesitamos.</p>
<p>Para volver a leer los datos en otra ocasión, usamos <code>read.csv()</code> tal como ya hemos hecho.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="poniendo-los-datos-en-forma.html#cb60-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;delitos.csv&quot;</span>)</span></code></pre></div>
<p>Y si queremos saber exactamente dónde ha guardado R nuestros datos, por ejemplo para abrirlos con otro programa, usamos la función <code>getwd</code> (por <em>get working directory</em> )</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="poniendo-los-datos-en-forma.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<p>El resultado será la dirección (la ubicación de la la carpeta), donde estamos trabajando y hemos guardado los datos; por ejemplo <code>/home/antonio/Practicando R/</code>.</p>
</div>
<div id="transformando-los-datos" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Transformando los datos<a href="poniendo-los-datos-en-forma.html#transformando-los-datos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Habiendo revisado el contenido de un dataframe (y agregado alguna variable si hiciera falta), comenzamos a hacernos idea de los ajustes que necesita para que los datos tomen el formato que necesitamos. Estos ajustes pueden ser correcciones (por ejemplo, de errores de tipeo cuando se cargaron los datos), la creación de nuevas variables derivadas de las existentes, o un reordenamiento de los datos para simplificar nuestro trabajo.</p>
<p>Para hacer todo esto, y mucho más, vamos a aprender funciones que representan cinco verbos básicos para la transformación de datos:</p>
<ul>
<li><code>select()</code>: seleccionar -elegir- columnas por su nombre</li>
<li><code>filter()</code>: filtrar, es decir quedarse sólo con las filas que cumplan cierta condición</li>
<li><code>arrange()</code>: ordenar las filas de acuerdo a su contenido o algún otro índice</li>
<li><code>mutate()</code>: mutar -cambiar- un dataframe, modificando el contenido de sus columnas o creando columnas (es decir, variables) nuevas</li>
<li><code>summarise()</code>: producir sumarios -un valor extraído de muchos, por ejemplo el promedio- con el contenido de las columnas</li>
</ul>
<p>Estas funciones tienen una sintaxis, una forma de escribirse, uniforme. El primer argumento que toman siempre es un dataframe; los siguientes indican qué hacer con los datos. El resultado siempre es un nuevo dataframe.</p>
<p>Las funciones son parte de <a href="http://dplyr.tidyverse.org/">dplyr</a>, uno de los componentes de la familia de paquetes <a href="https://www.tidyverse.org/">Tidyverse</a>. Ya tenemos disponible todo lo necesario, activado cuando invocamos <code>library(tidyverse)</code> al comienzo.</p>
<p>Manos a la obra.</p>
<div id="seleccionar-columnas-con-select" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Seleccionar columnas con <code>select()</code><a href="poniendo-los-datos-en-forma.html#seleccionar-columnas-con-select" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Muchas veces tendremos que lidiar con datasets con decenas de variables. Alguna que otra vez, con centenas. En esos casos el primer problema es librarnos de semejante cantidad de columnas, reteniendo sólo aquellas en las que estamos interesados. Para un dataset como el de reclamos de los ciudadanos, que tiene pocas columnas, select() no es tan importante. Aún así, podemos usar select() con fines demostrativos.</p>
<p>Sabemos que el dataset tiene 6 columnas:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="poniendo-los-datos-en-forma.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(delitos)</span></code></pre></div>
<pre><code>## [1] &quot;periodo&quot; &quot;tipo&quot;    &quot;subtipo&quot; &quot;barrio&quot;  &quot;total&quot;   &quot;comuna&quot;</code></pre>
<p>Si quisiéramos sólo las que contienen el período y el total, las seleccionamos por nombre, a continuación del nombre del dataframe:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="poniendo-los-datos-en-forma.html#cb64-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">select</span>(delitos, periodo, total)</span>
<span id="cb64-2"><a href="poniendo-los-datos-en-forma.html#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="poniendo-los-datos-en-forma.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["total"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"1","_rn_":"1"},{"1":"01/2020","2":"1","_rn_":"2"},{"1":"01/2020","2":"1","_rn_":"3"},{"1":"01/2020","2":"1","_rn_":"4"},{"1":"01/2020","2":"1","_rn_":"5"},{"1":"01/2020","2":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>También podemos seleccionar por contigüidad, por ejemplo “todas las columnas que van de <em>tipo</em> a <em>barrio</em>”:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="poniendo-los-datos-en-forma.html#cb65-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">select</span>(delitos, tipo<span class="sc">:</span>barrio)</span>
<span id="cb65-2"><a href="poniendo-los-datos-en-forma.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="poniendo-los-datos-en-forma.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["tipo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Homicidio","2":"Doloso","3":"Barracas","_rn_":"1"},{"1":"Homicidio","2":"Doloso","3":"Nueva Pompeya","_rn_":"2"},{"1":"Homicidio","2":"Doloso","3":"Retiro","_rn_":"3"},{"1":"Homicidio","2":"Doloso","3":"Saavedra","_rn_":"4"},{"1":"Homicidio","2":"Femicidio","3":"Villa Devoto","_rn_":"5"},{"1":"Homicidio","2":"Siniestro Vial","3":"Balvanera","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Y podemos seleccionar por omisión. Si nos interesara todo el contenido del dataset menos la variable <em>subtipo</em>, usaríamos</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="poniendo-los-datos-en-forma.html#cb66-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">select</span>(delitos, <span class="sc">-</span>subtipo)</span>
<span id="cb66-2"><a href="poniendo-los-datos-en-forma.html#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="poniendo-los-datos-en-forma.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[3],"type":["chr"],"align":["left"]},{"label":["total"],"name":[4],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Barracas","4":"1","5":"4","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"Nueva Pompeya","4":"1","5":"4","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"Retiro","4":"1","5":"1","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"Saavedra","4":"1","5":"12","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"Villa Devoto","4":"1","5":"11","_rn_":"5"},{"1":"01/2020","2":"Homicidio","3":"Balvanera","4":"1","5":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Al igual que con las selección por inclusión, podemos seleccionar por omisión de un rango de columnas contiguas (escritas entre paréntesis), o de varias columnas nombradas:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="poniendo-los-datos-en-forma.html#cb67-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">select</span>(delitos, <span class="sc">-</span>(subtipo<span class="sc">:</span>total))</span>
<span id="cb67-2"><a href="poniendo-los-datos-en-forma.html#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="poniendo-los-datos-en-forma.html#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["comuna"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"4","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"4","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"1","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"12","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"11","_rn_":"5"},{"1":"01/2020","2":"Homicidio","3":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="poniendo-los-datos-en-forma.html#cb68-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">select</span>(delitos, <span class="sc">-</span>tipo, <span class="sc">-</span>barrio)</span>
<span id="cb68-2"><a href="poniendo-los-datos-en-forma.html#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="poniendo-los-datos-en-forma.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["total"],"name":[3],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Doloso","3":"1","4":"4","_rn_":"1"},{"1":"01/2020","2":"Doloso","3":"1","4":"4","_rn_":"2"},{"1":"01/2020","2":"Doloso","3":"1","4":"1","_rn_":"3"},{"1":"01/2020","2":"Doloso","3":"1","4":"12","_rn_":"4"},{"1":"01/2020","2":"Femicidio","3":"1","4":"11","_rn_":"5"},{"1":"01/2020","2":"Siniestro Vial","3":"1","4":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="filtrar-filas-con-filter" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Filtrar filas con <code>filter()</code><a href="poniendo-los-datos-en-forma.html#filtrar-filas-con-filter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una de las tareas más frecuentes en el análisis de datos es la de identificar observaciones que cumplen con determinada condición. <code>filter()</code> permite extraer subconjuntos del total en base a sus variables.</p>
<p>Por ejemplo, para seleccionar registros que correspondan a Retiro, ocurridos en el primer mes de 2020 (período “01/2020”):</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="poniendo-los-datos-en-forma.html#cb69-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, barrio <span class="sc">==</span> <span class="st">&quot;Retiro&quot;</span>, periodo <span class="sc">==</span> <span class="st">&quot;01/2020&quot;</span>)</span>
<span id="cb69-2"><a href="poniendo-los-datos-en-forma.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","_rn_":"1"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Retiro","5":"130","6":"1","_rn_":"2"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"Hurto Automotor","4":"Retiro","5":"2","6":"1","_rn_":"3"},{"1":"01/2020","2":"Lesiones","3":"Siniestro Vial","4":"Retiro","5":"16","6":"1","_rn_":"4"},{"1":"01/2020","2":"Robo (con violencia)","3":"","4":"Retiro","5":"165","6":"1","_rn_":"5"},{"1":"01/2020","2":"Robo (con violencia)","3":"Con uso de moto","4":"Retiro","5":"12","6":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="comparaciones" class="section level4 hasAnchor" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Comparaciones<a href="poniendo-los-datos-en-forma.html#comparaciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aquí hemos usado un recurso nuevo, la comparación. R provee una serie de símbolos que permite comparar valores entre sí:</p>
<ul>
<li><p><code>==</code> igual a</p></li>
<li><p><code>!=</code> no igual (distinto) a</p></li>
<li><p><code>&gt;</code> mayor a</p></li>
<li><p><code>&gt;=</code> mayor o igual a</p></li>
<li><p><code>&lt;</code> menor a</p></li>
<li><p><code>&lt;=</code> menor o igual a</p></li>
</ul>
<div class="warning">
<p>Atención especial merece el símbolo que compara igualdad, <code>==</code>. Un error muy común es escribir <code>barrio = "Retiro"</code>, (un sólo símbolo <code>=</code>) que le indica a R que guarde el valor “Retiro” dentro de la variable <em>barrio</em>, en lugar de verificar si son iguales. Para ésto último, lo correcto es <code>barrio == "Retiro"</code>, tal como lo usamos en el ejemplo para <code>filter()</code>.</p>
</div>
<p>También hay que tener en cuenta el uso de comillas. Para que R no se confunda, cuando queramos usar valores de texto (de tipo <em>character</em>) los rodeamos con comillas para que quede claro que no nos referimos a una variable con ese nombre, si la hubiera, sino en forma literal a esa palabra o secuencia de texto. En el caso de los números, no hace falta el uso de comillas, ya que en R ningún nombre de variable puede comenzar con o estar compuesta sólo por números.</p>
<p>Filtrando los registros de períodos para los cuales se registran más de 100 incidentes:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="poniendo-los-datos-en-forma.html#cb70-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, total <span class="sc">&gt;</span> <span class="dv">100</span>)</span>
<span id="cb70-2"><a href="poniendo-los-datos-en-forma.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Almagro","5":"142","6":"5","_rn_":"1"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Balvanera","5":"306","6":"3","_rn_":"2"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Belgrano","5":"142","6":"13","_rn_":"3"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Caballito","5":"157","6":"6","_rn_":"4"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Flores","5":"143","6":"7","_rn_":"5"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Monserrat","5":"127","6":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="operadores-lógicos" class="section level4 hasAnchor" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> Operadores lógicos<a href="poniendo-los-datos-en-forma.html#operadores-lógicos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cuando le pasamos múltiples condiciones a filter(), la función devuelve las filas que cumplen con todas.</p>
<p>Por ejemplo, con</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="poniendo-los-datos-en-forma.html#cb71-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, periodo <span class="sc">==</span> <span class="st">&quot;08/2020&quot;</span>,  tipo <span class="sc">==</span> <span class="st">&quot;Homicidio&quot;</span>)</span>
<span id="cb71-2"><a href="poniendo-los-datos-en-forma.html#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="poniendo-los-datos-en-forma.html#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Barracas","5":"4","6":"4","_rn_":"1"},{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Belgrano","5":"1","6":"13","_rn_":"2"},{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Boca","5":"1","6":"4","_rn_":"3"},{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Caballito","5":"1","6":"6","_rn_":"4"},{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Chacarita","5":"3","6":"15","_rn_":"5"},{"1":"08/2020","2":"Homicidio","3":"Doloso","4":"Constitución","5":"1","6":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>obtenemos todos los registros cuyo rubro es “Homicidio”, y cuyo período es 08/2020, agosto de 2020.</p>
<p>Siguiendo el mismo formato, si intentamos</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="poniendo-los-datos-en-forma.html#cb72-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, barrio <span class="sc">==</span> <span class="st">&quot;Retiro&quot;</span>, barrio <span class="sc">==</span> <span class="st">&quot;Palermo&quot;</span>)</span>
<span id="cb72-2"><a href="poniendo-los-datos-en-forma.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="poniendo-los-datos-en-forma.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>obtenemos un conjunto vacío. ¿Por qué? Es debido a que ninguna observación cumple con todas las condiciones; en ningún registro el barrio es Retiro y también es Palermo. ¡Suena razonable!. Para obtener registros ocurridos en Retiro <strong>ó</strong> en Palermo, usamos el operador lógico <code>|</code> que significa… “ó”.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="poniendo-los-datos-en-forma.html#cb73-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, barrio <span class="sc">==</span> <span class="st">&quot;Retiro&quot;</span> <span class="sc">|</span> barrio <span class="sc">==</span> <span class="st">&quot;Palermo&quot;</span>)</span>
<span id="cb73-2"><a href="poniendo-los-datos-en-forma.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="poniendo-los-datos-en-forma.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","_rn_":"1"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Palermo","5":"349","6":"14","_rn_":"2"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Retiro","5":"130","6":"1","_rn_":"3"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"Hurto Automotor","4":"Palermo","5":"19","6":"14","_rn_":"4"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"Hurto Automotor","4":"Retiro","5":"2","6":"1","_rn_":"5"},{"1":"01/2020","2":"Lesiones","3":"Siniestro Vial","4":"Palermo","5":"48","6":"14","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Se trata de la lógica de conjuntos, o lógica <em>booleana</em>, que con un poco de suerte recordamos de nuestra época de escolares. Los símbolos importantes son <code>&amp;</code>, <code>|</code>, y <code>!</code>: “y”, “ó”, y la negación que invierte preposiciones:</p>
<ul>
<li><p><code>a &amp; b</code> a y b</p></li>
<li><p><code>a | b</code> a ó b</p></li>
<li><p><code>a &amp; !b</code> a, y no b</p></li>
<li><p><code>!a &amp; b</code> no a, y b</p></li>
<li><p><code>!(a &amp; b)</code> no (a y b)</p></li>
</ul>
<p>Hemos visto ejemplos de <code>a &amp; b</code> (<code>periodo == "08/2020",  tipo == "Homicidio"</code>, que <code>filter()</code> toma como un <code>&amp;</code>) y de <code>a | b</code> (cuando optamos por <code>barrio == "Retiro" | barrio == "Palermo"</code>)</p>
<p>Un ejemplo de <code>a &amp; !b</code> : pedimos filas en las que el tipo sea “Robo (con violencia)”, y además el subtipo no sea “Robo Automotor”:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="poniendo-los-datos-en-forma.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(delitos, tipo <span class="sc">==</span> <span class="st">&quot;Robo (con violencia)&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span>(subtipo <span class="sc">==</span> <span class="st">&quot;Robo Automotor&quot;</span>))</span></code></pre></div>
<p>Y como ejemplo de <code>!(a &amp; b)</code>, todas las filas excepto las de tipo “Homicidio” con subtipo “Siniestro Vial”:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="poniendo-los-datos-en-forma.html#cb75-1" aria-hidden="true" tabindex="-1"></a>seleccion <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, <span class="sc">!</span>(tipo <span class="sc">==</span> <span class="st">&quot;Homicidio&quot;</span> <span class="sc">&amp;</span> subtipo <span class="sc">==</span> <span class="st">&quot;Siniestro Vial&quot;</span>))</span>
<span id="cb75-2"><a href="poniendo-los-datos-en-forma.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="poniendo-los-datos-en-forma.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seleccion)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Barracas","5":"1","6":"4","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Nueva Pompeya","5":"1","6":"4","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Saavedra","5":"1","6":"12","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"Femicidio","4":"Villa Devoto","5":"1","6":"11","_rn_":"5"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"","5":"5","6":"NA","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="ordenar-filas-con-arrange" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Ordenar filas con <code>arrange()</code><a href="poniendo-los-datos-en-forma.html#ordenar-filas-con-arrange" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La función <code>arrange()</code> cambia el orden en el que aparecen las filas de un dataframe. Como primer parámetro toma un dataframe, al igual que el resto de los verbos de transformación que estamos aprendiendo. A continuación, espera un set de columnas para definir el orden.</p>
<p>Por ejemplo, para ordenar por total de registros:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="poniendo-los-datos-en-forma.html#cb76-1" aria-hidden="true" tabindex="-1"></a>ordenado <span class="ot">&lt;-</span> <span class="fu">arrange</span>(delitos, total)</span>
<span id="cb76-2"><a href="poniendo-los-datos-en-forma.html#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="poniendo-los-datos-en-forma.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ordenado)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Barracas","5":"1","6":"4","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Nueva Pompeya","5":"1","6":"4","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Saavedra","5":"1","6":"12","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"Femicidio","4":"Villa Devoto","5":"1","6":"11","_rn_":"5"},{"1":"01/2020","2":"Homicidio","3":"Siniestro Vial","4":"Balvanera","5":"1","6":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Si agregamos más columnas, se usan en orden para “desempatar”. Por ejemplo, si queremos que las filas con el mismo valor en <em>total</em> aparezcan en el orden alfabético del barrio que les corresponde, sólo necesitamos agregar esa columna:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="poniendo-los-datos-en-forma.html#cb77-1" aria-hidden="true" tabindex="-1"></a>ordenado <span class="ot">&lt;-</span> <span class="fu">arrange</span>(delitos, total, barrio)</span>
<span id="cb77-2"><a href="poniendo-los-datos-en-forma.html#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="poniendo-los-datos-en-forma.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ordenado)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"05/2020","2":"Robo (con violencia)","3":"Con uso de moto","4":"","5":"1","6":"NA","_rn_":"1"},{"1":"09/2020","2":"Robo (con violencia)","3":"","4":"","5":"1","6":"NA","_rn_":"2"},{"1":"12/2020","2":"Robo (con violencia)","3":"Robo Automotor","4":"","5":"1","6":"NA","_rn_":"3"},{"1":"03/2020","2":"Lesiones","3":"Siniestro Vial","4":"Agronomía","5":"1","6":"15","_rn_":"4"},{"1":"04/2020","2":"Lesiones","3":"Siniestro Vial","4":"Agronomía","5":"1","6":"15","_rn_":"5"},{"1":"06/2020","2":"Hurto (sin violencia)","3":"Hurto Automotor","4":"Agronomía","5":"1","6":"15","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Si no se aclara lo contrario, el orden siempre es ascendente (de menor a mayor). Si quisiéramos orden de mayor a menor, usamos <code>desc()</code>:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="poniendo-los-datos-en-forma.html#cb78-1" aria-hidden="true" tabindex="-1"></a>ordenado <span class="ot">&lt;-</span> <span class="fu">arrange</span>(delitos, <span class="fu">desc</span>(total))</span>
<span id="cb78-2"><a href="poniendo-los-datos-en-forma.html#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="poniendo-los-datos-en-forma.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ordenado)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]}],"data":[{"1":"02/2020","2":"Hurto (sin violencia)","3":"","4":"Palermo","5":"393","6":"14","_rn_":"1"},{"1":"01/2020","2":"Robo (con violencia)","3":"","4":"Palermo","5":"362","6":"14","_rn_":"2"},{"1":"02/2020","2":"Robo (con violencia)","3":"","4":"Palermo","5":"356","6":"14","_rn_":"3"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Palermo","5":"349","6":"14","_rn_":"4"},{"1":"01/2020","2":"Robo (con violencia)","3":"","4":"Balvanera","5":"323","6":"3","_rn_":"5"},{"1":"01/2020","2":"Hurto (sin violencia)","3":"","4":"Balvanera","5":"306","6":"3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="valores-faltantes" class="section level4 hasAnchor" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> Valores faltantes<a href="poniendo-los-datos-en-forma.html#valores-faltantes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En el último ejemplo, aparecen varias filas cuyo valor para la columna BARRIO es <code>NA</code>. R representa los valores ausentes, desconocidos, con <code>NA</code> (“no disponible”, del inglés <em>Not Available</em>). Hay que tener cuidado con los valores <code>NA</code>, porque la mayoría de las comparaciones y operaciones lógicas que los involucran resultan indefinidas. En la práctica:</p>
<p>¿Es 10 mayor a un valor desconocido?</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="poniendo-los-datos-en-forma.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="sc">&gt;</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>R no sabe. (Nadie lo sabe, para ser justos)</p>
<p>¿A cuanto asciende la suma de 10 más un valor desconocido?</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="poniendo-los-datos-en-forma.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">+</span> <span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Y en particular… ¿es un valor desconocido igual a otro valor desconocido?</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="poniendo-los-datos-en-forma.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Por supuesto, la respuesta es desconocida también. La insistencia de R en no definir operaciones que involucran NA’s podría parecer irritante a primera vista, pero en realidad nos hace un favor. Al evitar extraer conclusiones cuando trata con datos faltantes, nos evita caer en errores garrafales en los casos en que analizamos y comparamos datos incompletos. Además, podemos preguntar a R si un valor es desconocido, y allí si contesta con seguridad. La función requerida es <code>is.na()</code>.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="poniendo-los-datos-en-forma.html#cb85-1" aria-hidden="true" tabindex="-1"></a>desconocido <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb85-2"><a href="poniendo-los-datos-en-forma.html#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="poniendo-los-datos-en-forma.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(desconocido)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Algo más a tener en cuenta con los valores desconocidos es cómo son interpretados cuando usamos funciones de transformación de datos. Por ejemplo, <code>filter()</code> ignora las filas que contienen NA’s en la variable que usa para filtrar. <code>arrange()</code> muestra las filas con NA’s en el campo por el que ordena, pero todas al final.</p>
</div>
</div>
<div id="agregar-nuevas-variables-con-mutate" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Agregar nuevas variables con <code>mutate()</code><a href="poniendo-los-datos-en-forma.html#agregar-nuevas-variables-con-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recurrimos a la función <code>mutate()</code> cuando queremos agregarle columnas adicionales a nuestro dataframe, en general en base a los valores de las columnas ya existentes. Vamos a ilustrarlo con un ejemplo sencillo. Imaginemos que tenemos el siguiente dataset:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="poniendo-los-datos-en-forma.html#cb87-1" aria-hidden="true" tabindex="-1"></a>circulos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">nombre =</span> <span class="fu">c</span>(<span class="st">&quot;Círculo 1&quot;</span>, <span class="st">&quot;Círculo 2&quot;</span>, <span class="st">&quot;Círculo 3&quot;</span>),</span>
<span id="cb87-2"><a href="poniendo-los-datos-en-forma.html#cb87-2" aria-hidden="true" tabindex="-1"></a>                       tamaño <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Pequeño&quot;</span>, <span class="st">&quot;Mediano&quot;</span>, <span class="st">&quot;Grande&quot;</span>),</span>
<span id="cb87-3"><a href="poniendo-los-datos-en-forma.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">radio  =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb87-4"><a href="poniendo-los-datos-en-forma.html#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="poniendo-los-datos-en-forma.html#cb87-5" aria-hidden="true" tabindex="-1"></a>circulos</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["nombre"],"name":[1],"type":["chr"],"align":["left"]},{"label":["tamaño"],"name":[2],"type":["chr"],"align":["left"]},{"label":["radio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Círculo 1","2":"Pequeño","3":"1"},{"1":"Círculo 2","2":"Mediano","3":"3"},{"1":"Círculo 3","2":"Grande","3":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Podemos agregar una columna con el área de cada círculo con mutate():</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="poniendo-los-datos-en-forma.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(circulos, <span class="at">area =</span> <span class="fl">3.1416</span> <span class="sc">*</span> radio<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["nombre"],"name":[1],"type":["chr"],"align":["left"]},{"label":["tamaño"],"name":[2],"type":["chr"],"align":["left"]},{"label":["radio"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["area"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Círculo 1","2":"Pequeño","3":"1","4":"3.1416"},{"1":"Círculo 2","2":"Mediano","3":"3","4":"28.2744"},{"1":"Círculo 3","2":"Grande","3":"5","4":"78.5400"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Usando mutate(), definimos la columna “area”, indicando que su contenido será el valor de la columna “radio” en cada registro puesto en la fórmula del área de un círculo. Los operadores aritméticos (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>) son con frecuencia útiles para usar en conjunto con mutate().</p>
<p>Volvamos ahora a nuestro dataframe con datos de delitos. Supongamos que nos interesa agregar columnas con el mes y el año de cada registro. La columna período, con valores del tipo “01/2020”, contiene la información necesaria para obtener estas dos nuevas variables. Para separar la parte del año de la parte del mes, la función <code>substr()</code>, que extrae porciones de una variable de texto, nos va a dar una mano. La usamos así: el primer parámetro es una secuencia de caracteres, y los dos siguientes indican donde queremos que empiece y termine la porción a extraer.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="poniendo-los-datos-en-forma.html#cb89-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="ot">&lt;-</span> <span class="fu">mutate</span>(delitos,</span>
<span id="cb89-2"><a href="poniendo-los-datos-en-forma.html#cb89-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mes =</span> <span class="fu">substr</span>(periodo, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb89-3"><a href="poniendo-los-datos-en-forma.html#cb89-3" aria-hidden="true" tabindex="-1"></a>                  año <span class="ot">=</span> <span class="fu">substr</span>(periodo, <span class="dv">4</span>, <span class="dv">7</span>))</span>
<span id="cb89-4"><a href="poniendo-los-datos-en-forma.html#cb89-4" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb89-5"><a href="poniendo-los-datos-en-forma.html#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(delitos) </span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["periodo"],"name":[1],"type":["fct"],"align":["left"]},{"label":["tipo"],"name":[2],"type":["fct"],"align":["left"]},{"label":["subtipo"],"name":[3],"type":["fct"],"align":["left"]},{"label":["barrio"],"name":[4],"type":["chr"],"align":["left"]},{"label":["total"],"name":[5],"type":["int"],"align":["right"]},{"label":["comuna"],"name":[6],"type":["int"],"align":["right"]},{"label":["mes"],"name":[7],"type":["chr"],"align":["left"]},{"label":["año"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Barracas","5":"1","6":"4","7":"01","8":"2020","_rn_":"1"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Nueva Pompeya","5":"1","6":"4","7":"01","8":"2020","_rn_":"2"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Retiro","5":"1","6":"1","7":"01","8":"2020","_rn_":"3"},{"1":"01/2020","2":"Homicidio","3":"Doloso","4":"Saavedra","5":"1","6":"12","7":"01","8":"2020","_rn_":"4"},{"1":"01/2020","2":"Homicidio","3":"Femicidio","4":"Villa Devoto","5":"1","6":"11","7":"01","8":"2020","_rn_":"5"},{"1":"01/2020","2":"Homicidio","3":"Siniestro Vial","4":"Balvanera","5":"1","6":"3","7":"01","8":"2020","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="extraer-resúmenes-con-summarise" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Extraer resúmenes con <code>summarise()</code><a href="poniendo-los-datos-en-forma.html#extraer-resúmenes-con-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Llegamos al último de los verbos fundamentales para transformar datos. <code>summarise()</code> (por “resumir” en inglés) toma un dataframe completo y lo resume un una sola fila, de acuerdo a la operación que indiquemos. R ofrece una función que calcula promedios, <code>mean()</code>, que podríamos usar para obtener el promedio de la columna “total”:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="poniendo-los-datos-en-forma.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(delitos, <span class="at">promedio =</span> <span class="fu">mean</span>(total))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["promedio"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"20.93005"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Bien, la cantidad promedio de delitos registrados en un mismo barrio y en un mismo mes, en 2020, es esa. Pero en general necesitamos un poco más de detalle sobre los datos que estamos explorando.</p>
<p>Es que por si sola, <code>summarise()</code> no es de mucha ayuda. La gracia está en combinarla con <code>group_by()</code>, que cambia la unidad de análisis del dataframe completo a grupos individuales. Usar <code>summarise()</code> sobre un dataframe al que antes agrupamos con <code>group_by</code> resulta en resúmenes “por grupo”.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="poniendo-los-datos-en-forma.html#cb91-1" aria-hidden="true" tabindex="-1"></a>agrupado <span class="ot">&lt;-</span> <span class="fu">group_by</span>(delitos, año)</span>
<span id="cb91-2"><a href="poniendo-los-datos-en-forma.html#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="poniendo-los-datos-en-forma.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(delitos, <span class="at">promedio_totales =</span> <span class="fu">mean</span>(total))</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["promedio_totales"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"20.93005"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Podemos agrupar por múltiples columnas, generando más subgrupos; por ejemplo, promedios por año y mes…</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="poniendo-los-datos-en-forma.html#cb92-1" aria-hidden="true" tabindex="-1"></a>agrupado <span class="ot">&lt;-</span> <span class="fu">group_by</span>(delitos, año, mes)</span>
<span id="cb92-2"><a href="poniendo-los-datos-en-forma.html#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="poniendo-los-datos-en-forma.html#cb92-3" aria-hidden="true" tabindex="-1"></a>sumario <span class="ot">&lt;-</span> <span class="fu">summarise</span>(agrupado, <span class="at">promedio =</span> <span class="fu">mean</span>(total))</span>
<span id="cb92-4"><a href="poniendo-los-datos-en-forma.html#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="poniendo-los-datos-en-forma.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sumario)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["año"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mes"],"name":[2],"type":["chr"],"align":["left"]},{"label":["promedio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"2020","2":"01","3":"34.735915"},{"1":"2020","2":"02","3":"33.441281"},{"1":"2020","2":"03","3":"21.546429"},{"1":"2020","2":"04","3":"8.981308"},{"1":"2020","2":"05","3":"12.738776"},{"1":"2020","2":"06","3":"14.403101"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>… o por año, mes y barrio:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="poniendo-los-datos-en-forma.html#cb93-1" aria-hidden="true" tabindex="-1"></a>agrupado <span class="ot">&lt;-</span> <span class="fu">group_by</span>(delitos, año, mes, barrio)</span>
<span id="cb93-2"><a href="poniendo-los-datos-en-forma.html#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="poniendo-los-datos-en-forma.html#cb93-3" aria-hidden="true" tabindex="-1"></a>sumario <span class="ot">&lt;-</span> <span class="fu">summarise</span>(agrupado, <span class="at">promedio =</span> <span class="fu">mean</span>(total))</span>
<span id="cb93-4"><a href="poniendo-los-datos-en-forma.html#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="poniendo-los-datos-en-forma.html#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sumario)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["año"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mes"],"name":[2],"type":["chr"],"align":["left"]},{"label":["barrio"],"name":[3],"type":["chr"],"align":["left"]},{"label":["promedio"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2020","2":"01","3":"","4":"16.00"},{"1":"2020","2":"01","3":"Agronomía","4":"7.75"},{"1":"2020","2":"01","3":"Almagro","4":"79.40"},{"1":"2020","2":"01","3":"Balvanera","4":"103.00"},{"1":"2020","2":"01","3":"Barracas","4":"50.00"},{"1":"2020","2":"01","3":"Belgrano","4":"57.50"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Con <code>summarise()</code> podemos usar cualquier función que tome una lista de valores y devuelva un sólo resultado. Para empezar, algunas de las que más podrían ayudarnos son:</p>
<ul>
<li><code>mean()</code>: Obtiene el promedio de los valores</li>
<li><code>sum()</code>: Obtiene la suma</li>
<li><code>min()</code>: Obtiene el valor más bajo</li>
<li><code>max()</code>: Obtiene el valor más alto</li>
</ul>
<div class="tip">
<p>R es cauteloso cuando se encuentra con nuestros amigos los datos faltantes, o NA’s: si le pedimos que calcule el promedio de una columna que contiene datos faltantes, indica que el resultado es desconocido. ¡Dice que el resultado es NA!. Lo mismo ocurre con otras funciones que también extraen un valor único, de resumen, a partir de un conjunto de datos (como <code>sum()</code>, <code>min()</code>, etc).</p>
<p>Esto tiene sentido si lo pensamos así: el valor promedio de un conjunto de mediciones que son “5”, “8”, y “desconocido” es efectivamente desconocido, porque nos falta un dato para poder saberlo con certeza. Por otra parte, es común que nos alcance con saber cual es el resultado para los valores conocidos, y aceptamos el riesgo de ignorar los que no tenemos. Para esos casos existe el parámetro <code>na.rm</code>, que descarta los faltantes antes de hacer el cálculo. Lo usamos así: <code>mean(total, na.rm = TRUE)</code></p>
</div>
</div>
<div id="bonus-el-operador-pipe" class="section level3 hasAnchor" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> ¡BONUS! El operador “pipe”: <code>%&gt;%</code><a href="poniendo-los-datos-en-forma.html#bonus-el-operador-pipe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Antes de terminar, vamos a presentar una herramienta más: el operador <em>pipe</em> (pronúnciese “paip”, es el término en inglés que significa “tubo”).</p>
<p>El pipe es un operador: un símbolo que relaciona dos entidades. Dicho en forma más simple, el pipe de R, cuyo símbolo es <code>%&gt;%</code> está en familia con otros operadores más convencionales, como <code>+</code>, <code>-</code> o <code>/</code>. Y al igual que los otros operadores, entrega un resultado en base a los operandos que recibe. Ahora bien… ¿Para qué sirve? En resumidas cuentas, hace que el código necesario para realizar una serie de operaciones de transformación de datos sea mucho más simple de escribir y de interpretar.</p>
<p>Por ejemplo, si quisiéramos obtener el top 5 de los barrios que más reclamos y denuncias de los ciudadanos han registrado durante marzo, la forma de lograrlo en base a lo que ya sabemos sería así:</p>
<ol style="list-style-type: decimal">
<li>Filtramos los datos para aislar los registros de marzo;</li>
<li>agrupamos por barrio;</li>
<li>hacemos un resumen, creando una variable resumen que contiene la suma de los registros para cada barrio;</li>
<li>los ordenamos en forma descendiente,</li>
<li>mostramos sólo los primeros 5 (esto se puede hacer con la función <code>head()</code>, aclarando cuantas filas queremos ver)</li>
</ol>
<p>En código:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="poniendo-los-datos-en-forma.html#cb94-1" aria-hidden="true" tabindex="-1"></a>solo_marzo <span class="ot">&lt;-</span> <span class="fu">filter</span>(delitos, mes <span class="sc">==</span> <span class="st">&quot;03&quot;</span>)</span>
<span id="cb94-2"><a href="poniendo-los-datos-en-forma.html#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="poniendo-los-datos-en-forma.html#cb94-3" aria-hidden="true" tabindex="-1"></a>solo_marzo_agrupado_barrio <span class="ot">&lt;-</span> <span class="fu">group_by</span>(solo_marzo, barrio)</span>
<span id="cb94-4"><a href="poniendo-los-datos-en-forma.html#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="poniendo-los-datos-en-forma.html#cb94-5" aria-hidden="true" tabindex="-1"></a>total_por_barrio_marzo <span class="ot">&lt;-</span> <span class="fu">summarise</span>(solo_marzo_agrupado_barrio, <span class="at">total =</span> <span class="fu">sum</span>(total))</span>
<span id="cb94-6"><a href="poniendo-los-datos-en-forma.html#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="poniendo-los-datos-en-forma.html#cb94-7" aria-hidden="true" tabindex="-1"></a>total_por_barrio_marzo_ordenado <span class="ot">&lt;-</span> <span class="fu">arrange</span>(total_por_barrio_marzo, <span class="fu">desc</span>(total))</span>
<span id="cb94-8"><a href="poniendo-los-datos-en-forma.html#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="poniendo-los-datos-en-forma.html#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(total_por_barrio_marzo_ordenado, <span class="dv">5</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["barrio"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Palermo","2":"529"},{"1":"Balvanera","2":"407"},{"1":"Flores","2":"294"},{"1":"San Nicolás","2":"282"},{"1":"Caballito","2":"257"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>¡Funciona! Pero… el problema es que hemos generado un puñado de variables (“solo_marzo”, “solo_marzo_agrupado_barrio”, etc) que, es probable, no volveremos a usar. Además de ser inútiles una vez obtenido el resultado buscado, estas variables intermedias requieren que las nombremos. Decidir el nombre de estas variables que no nos importan toma tiempo (sobre todo cuando producimos muchas), y nos distrae de lo importante, que es el análisis.</p>
<p>El pipe, <code>%&gt;%</code>, permite encadenar operaciones, conectando el resultado de una como el dato de entrada de la siguiente. La misma secuencia que realizamos antes puede resolverse con pipes, quedando así:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="poniendo-los-datos-en-forma.html#cb95-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="poniendo-los-datos-en-forma.html#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mes <span class="sc">==</span> <span class="st">&quot;03&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="poniendo-los-datos-en-forma.html#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(barrio) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="poniendo-los-datos-en-forma.html#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(total)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="poniendo-los-datos-en-forma.html#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="poniendo-los-datos-en-forma.html#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["barrio"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Palermo","2":"529"},{"1":"Balvanera","2":"407"},{"1":"Flores","2":"294"},{"1":"San Nicolás","2":"282"},{"1":"Caballito","2":"257"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Una manera de pronunciar <code>%&gt;%</code> cuando leemos código es “y luego…”. Algo así como “tomamos el dataframe”delitos” y luego filtramos los registros del mes “03”, y luego agrupamos por barrio, y luego calculamos el total de registros para cada grupo, y luego los ordenamos en forma descendente por total, y luego vemos los cinco primeros”.</p>
<p>El uso de pipes permite concentrarse en las operaciones de transformación, y no en lo que está siendo transformado en cada paso. Esto hace al código mucho más sencillo de leer e interpretar. En el ejemplo con pipe, sólo tuvimos que nombrar un dataframe con el cual trabajar un única vez, al principio.</p>
<p>Detrás de escena, <code>x %&gt;% f(y)</code> se transforma en <code>f(x, y)</code>. Por eso,</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="poniendo-los-datos-en-forma.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(delitos, mes <span class="sc">==</span> <span class="st">&quot;03&quot;</span>)</span></code></pre></div>
<p>es equivalente a</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="poniendo-los-datos-en-forma.html#cb97-1" aria-hidden="true" tabindex="-1"></a>delitos <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mes <span class="sc">==</span> <span class="st">&quot;03&quot;</span>)</span></code></pre></div>
<p>Trabajar con pipes es una de las ventajas que hacen de R un lenguaje muy expresivo y cómodo para manipular datos, y a partir de aquí lo usaremos de forma habitual.</p>
<p>Con esto cerramos la sección de transformación de datos. Las técnicas para examinar un dataframe, como <code>summary()</code> nos permiten entender de forma rápida con que clase de variables vamos a trabajar. Los cinco verbos de manipulación que aprendimos, usados en conjunto, brindan una enorme capacidad para adaptar el formato de los datos a nuestras necesidades. Y el operador pipe nos ayuda a escribir nuestro código de forma sucinta y fácil de interpretar.</p>
<p>A medida que vayamos progresando en nuestra familiaridad con las funciones -y agregando técnicas nuevas- vamos a ser capaces de procesar grandes cantidades de datos con soltura. Y obtener en pocos minutos lo que de otra forma, sin herramientas computacionales, tardaría días o sería inviable por lo tedioso.</p>
</div>
</div>
<div id="ejercicios-1" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Ejercicios<a href="poniendo-los-datos-en-forma.html#ejercicios-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I. Tomemos otro dataset, como el que descargamos durante los ejercicios del capítulo anterior, e intentemos:</p>
<ul>
<li>usar <code>select()</code> para seleccionar ciertas columnas y/o cambiar su orden</li>
<li>usar <code>filter()</code> para filtrar las filas, descartando las que no cumplan cierta condición o condiciones a elección</li>
<li>usar <code>arrange()</code> para ordenar el dataframe según alguna de sus variables</li>
<li>usar <code>mutate()</code> para crear una o más columnas nuevas</li>
<li>usar en combinación <code>group_by()</code> y <code>summarise()</code> para generar un resumen del dataset, que contenga al menos 3 variables (se pueden usar medias, máximos, conteos, etc)</li>
</ul>
<ol start="2" style="list-style-type: upper-roman">
<li>Si antes hicimos todos los pasos por separado, ahora intentemos hacer todo el procedimiento en una sola cadena de instrucciones usando el operador pipe: <code>%&gt;%</code></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="una-presentación-a-toda-marcha-de-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualización.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CD_AJ.pdf", "CD_AJ.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
